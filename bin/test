#!/bin/bash

set -e

# Cleanup any remaining process from test/should-stop
function cleanup {
  pgrep -f 'test/should-stop' | xargs kill || true
}

trap cleanup EXIT

npm run build

if [ "$1" == '-int' ]; then
  ./node_modules/.bin/mocha built/test/unit-tests.js built/test/integration-tests.js ${@:2}
else
  ./node_modules/.bin/mocha built/test/unit-tests.js $@
fi
