#!/bin/bash

# Cleanup any remaining process from test/should-stop
function cleanup {
  pgrep -f 'test/should-stop' | xargs kill
}

trap cleanup EXIT

npm run build

function unit_test() {
  ./node_modules/.bin/mocha ./built/test/0-should-run-no-plug.js && \
    ./node_modules/.bin/mocha ./built/test/should-run-tests.js && \
    ./node_modules/.bin/mocha ./built/test/should-stop-tests.js
  ./node_modules/.bin/mocha ./built/test/test-hygiene.js
}

function int_test() {
  ./node_modules/.bin/mocha ./built/test/should-run-integration-tests.js
}

unit_test

if [ "$1" == '-int' ]; then
  int_test
fi
